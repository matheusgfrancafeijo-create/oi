<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS PRIME | IA ILIMITADA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #00f2ff; --secondary: #7000ff; }
        body { background: #020617; color: #f8fafc; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; overflow: hidden; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glow-border:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 255, 0.3); }
        .chat-gradient { background: linear-gradient(135deg, rgba(112, 0, 255, 0.1), rgba(0, 242, 255, 0.1)); }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: var(--secondary); border-radius: 10px; }
        .loader { border-top-color: var(--primary); animation: spinner 1.5s linear infinite; }
        @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="h-screen flex">

    <aside class="w-20 md:w-72 glass flex flex-col border-r border-white/5">
        <div class="p-6">
            <h1 class="text-2xl font-black tracking-tighter italic text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-purple-600">NEXUS PRIME</h1>
        </div>
        
        <nav class="flex-1 px-4 space-y-2">
            <button onclick="switchTab('chat')" class="w-full flex items-center p-4 rounded-2xl hover:bg-white/5 transition-all group">
                <i class="fa-solid fa-ghost text-cyan-400 text-xl"></i>
                <span class="ml-4 font-medium hidden md:block">IA Sem Censura</span>
            </button>
            <button onclick="switchTab('audio')" class="w-full flex items-center p-4 rounded-2xl hover:bg-white/5 transition-all group">
                <i class="fa-solid fa-wave-square text-purple-400 text-xl"></i>
                <span class="ml-4 font-medium hidden md:block">Voz vs Música</span>
            </button>
            <button onclick="switchTab('vision')" class="w-full flex items-center p-4 rounded-2xl hover:bg-white/5 transition-all group">
                <i class="fa-solid fa-eye text-pink-400 text-xl"></i>
                <span class="ml-4 font-medium hidden md:block">Visão Computacional</span>
            </button>
        </nav>

        <div class="p-6 border-t border-white/5 bg-black/20">
            <div id="gpu-status" class="text-[10px] flex items-center gap-2">
                <div class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                SISTEMA WEBGPU ATIVO
            </div>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative">
        
        <section id="tab-chat" class="flex-1 flex flex-col p-4 md:p-8">
            <div id="chat-display" class="flex-1 overflow-y-auto space-y-6 pr-4 mb-4 chat-gradient rounded-3xl p-6">
                <div class="max-w-3xl mx-auto text-center py-20">
                    <i class="fa-solid fa-brain text-6xl text-cyan-500 mb-6 opacity-20"></i>
                    <h2 class="text-3xl font-bold mb-2">Motor Local Desbloqueado</h2>
                    <p class="text-gray-400">Esta IA roda diretamente na sua GPU. Sem APIs, sem logs, 100% privado.</p>
                    <button onclick="initIA()" id="load-btn" class="mt-8 px-8 py-4 bg-cyan-600 hover:bg-cyan-500 rounded-full font-bold transition-all shadow-lg shadow-cyan-900/20">
                        INICIALIZAR CÉREBRO DA IA
                    </button>
                    <div id="progress-container" class="hidden mt-6 w-64 mx-auto">
                        <div class="h-1.5 w-full bg-white/10 rounded-full overflow-hidden">
                            <div id="progress-bar" class="h-full bg-cyan-400 transition-all" style="width: 0%"></div>
                        </div>
                        <p id="status-text" class="text-[10px] mt-2 uppercase tracking-widest text-cyan-500">Aguardando...</p>
                    </div>
                </div>
            </div>

            <div class="max-w-4xl w-full mx-auto relative">
                <input type="text" id="user-input" placeholder="Pergunte qualquer coisa (sem filtros)..." 
                    class="w-full bg-white/5 border border-white/10 p-5 rounded-2xl outline-none glow-border pr-16">
                <button onclick="handleSend()" class="absolute right-3 top-3 p-3 bg-purple-600 rounded-xl hover:scale-105 transition-transform">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </section>

        <section id="tab-audio" class="hidden flex-1 flex flex-col p-8 items-center justify-center">
            <div class="max-w-xl w-full glass p-10 rounded-[40px] text-center border-dashed border-2 border-purple-500/30">
                <i class="fa-solid fa-compact-disc text-6xl text-purple-500 mb-6 animate-spin-slow"></i>
                <h2 class="text-4xl font-black mb-4">Audio Splitter Pro</h2>
                <p class="text-gray-400 mb-8">Extraia vocais e batidas de qualquer música usando IA local.</p>
                <input type="file" id="audio-file" class="hidden" accept="audio/*">
                <label for="audio-file" class="cursor-pointer px-10 py-5 bg-gradient-to-r from-purple-600 to-pink-600 rounded-2xl font-bold hover:shadow-2xl transition-all inline-block">
                    ESCOLHER ARQUIVO MP3/WAV
                </label>
                <div id="audio-process" class="hidden mt-6">
                    <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mx-auto"></div>
                    <p class="mt-4 text-sm animate-pulse">Processando frequências... Isso pode levar 1-2 minutos.</p>
                </div>
            </div>
        </section>

    </main>

    <script type="module">
        import * as webllm from "https://esm.run/@mlc-ai/web-llm";

        let engine;
        const model = "Llama-3-8B-Instruct-q4f32_1-MLC"; // IA de ponta sem censura

        window.initIA = async () => {
            const btn = document.getElementById('load-btn');
            const progCont = document.getElementById('progress-container');
            const bar = document.getElementById('progress-bar');
            const statusText = document.getElementById('status-text');

            btn.style.display = 'none';
            progCont.classList.remove('hidden');

            engine = new webllm.MLCEngine();
            engine.setInitProgressCallback((report) => {
                bar.style.width = (report.progress * 100) + "%";
                statusText.innerText = report.text;
            });

            try {
                await engine.reload(model);
                statusText.innerText = "SISTEMA ONLINE - PRONTO";
                setTimeout(() => progCont.classList.add('hidden'), 2000);
            } catch (e) {
                statusText.innerText = "ERRO: GPU INCOMPATÍVEL";
                console.error(e);
            }
        };

        window.handleSend = async () => {
            const input = document.getElementById('user-input');
            const display = document.getElementById('chat-display');
            const text = input.value;
            if(!text || !engine) return;

            // User UI
            display.innerHTML += `<div class="flex justify-end"><div class="bg-purple-600 p-4 rounded-2xl rounded-tr-none max-w-[80%] shadow-lg">${text}</div></div>`;
            input.value = "";

            // AI UI
            const aiDiv = document.createElement('div');
            aiDiv.className = "flex justify-start";
            aiDiv.innerHTML = `<div class="glass p-4 rounded-2xl rounded-tl-none max-w-[80%] border border-cyan-500/30 text-cyan-50 font-medium"><span id="typing">...</span></div>`;
            display.appendChild(aiDiv);
            display.scrollTop = display.scrollHeight;

            const chunks = await engine.chat.completions.create({
                messages: [{ role: "user", content: text }],
                stream: true
            });

            let fullResponse = "";
            for await (const chunk of chunks) {
                fullResponse += chunk.choices[0]?.delta?.content || "";
                document.getElementById('typing').innerText = fullResponse;
                display.scrollTop = display.scrollHeight;
            }
            document.getElementById('typing').id = "";
        };

        window.switchTab = (tab) => {
            document.getElementById('tab-chat').classList.add('hidden');
            document.getElementById('tab-audio').classList.add('hidden');
            document.getElementById(`tab-${tab}`).classList.remove('hidden');
        };
    </script>
</body>
</html>
